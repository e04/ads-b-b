var Z=Object.defineProperty;var J=(e,o,u)=>o in e?Z(e,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[o]=u;var P=(e,o,u)=>(J(e,typeof o!="symbol"?o+"":o,u),u);import{m as ee,r as R,u as te,j as $,F as ae,H as re,a as G,S as V,B as ne,T as ie,b as N,c as Y,d as oe,R as se,e as xe,C as ce}from"./vendor.9b728d1d.js";const fe=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))d(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&d(i)}).observe(document,{childList:!0,subtree:!0});function u(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerpolicy&&(c.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?c.credentials="include":s.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function d(s){if(s.ep)return;s.ep=!0;const c=u(s);fetch(s.href,c)}};fe();function D(e){this._device=e}D.prototype.open=async function(){await this._device.open()};D.prototype.selectConfiguration=async function(e){await this._device.selectConfiguration(e)};D.prototype.claimInterface=async function(e){await this._device.claimInterface(e)};D.prototype.releaseInterface=async function(e){await this._device.releaseInterface(e)};D.prototype.controlTransfer=async function(e){if(e.direction==="out")await this._device.controlTransferOut(e,e.data);else if(e.direction==="in")return(await this._device.controlTransferIn(e,e.length)).data.buffer};D.prototype.bulkTransfer=async function(e){return(await this._device.transferIn(e.endpoint,e.length)).data.buffer};D.prototype.close=async function(){await this._device.close()};D.requestDevice=async function(e){const o=await navigator.usb.requestDevice({filters:e});return new D(o)};D.getDevices=async function(e,o){const u=navigator.usb.getDevices(),d=[];return u.forEach(s=>{e.forEach(c=>{c.vendorId===s.vendorId&&c.productId===s.productId&&d.push(new D(s))})}),d};function B(e){var o=!1,u=16;async function d(t,r,a){await g(r,t|u,a)}async function s(t,r,a){return await v(r,t,a)}async function c(t,r,a,p){await g(r,t|u,h(a,p))}async function i(t,r,a){return U(await v(r,t,a))}async function w(t,r,a,p){if(p==255)await c(t,r,a,1);else{var y=await i(t,r,1);a&=p,y&=~p,a|=y,await c(t,r,a,1)}}async function b(t,r){return await i(t,r<<8|32,1)}async function m(t,r,a,p){return await d(t,r<<8|32,h(a,p,!0)),await b(10,1)}async function S(){await m(1,1,24,1)}async function I(){await m(1,1,16,1)}async function O(t,r){return await d(F.I2C,t,new Uint8Array([r]).buffer),await i(F.I2C,t,1)}async function T(t,r,a){await d(F.I2C,t,new Uint8Array([r,a]).buffer)}async function k(t,r,a){return await d(F.I2C,t,new Uint8Array([r]).buffer),await s(F.I2C,t,a)}function U(t){var r=t.byteLength,a=new DataView(t);if(r==0)return null;if(r==1)return a.getUint8(0);if(r==2)return a.getUint16(0,!0);if(r==4)return a.getUint32(0,!0);throw"Cannot parse "+r+"-byte number"}function h(t,r,a){var p=new ArrayBuffer(r),y=new DataView(p);if(r==1)y.setUint8(0,t);else if(r==2)y.setUint16(0,t,!a);else if(r==4)y.setUint32(0,t,!a);else throw"Cannot write "+r+"-byte number";return p}async function v(t,r,a){var p={requestType:"vendor",recipient:"device",direction:"in",request:0,value:t,index:r,length:Math.max(8,a)};try{var y=await e.controlTransfer(p);return y=y.slice(0,a),y}catch(_){""+t.toString(16)+r.toString(16)+_.message}}async function g(t,r,a){var p={requestType:"vendor",recipient:"device",direction:"out",request:0,value:t,index:r,data:a};try{await e.controlTransfer(p)}catch(_){var y="USB write failed (value 0x"+t.toString(16)+" index 0x"+r.toString(16)+" data "+l(a)+') message="'+_.message+'"';throw y}}async function C(t){var r={direction:"in",endpoint:1,length:t};try{var a=await e.bulkTransfer(r);return a}catch(y){var p="USB bulk read failed (length 0x"+t.toString(16)+'), error="'+y.message+'"';throw p}}async function E(){await e.claimInterface(0)}async function x(){await e.releaseInterface(0)}async function f(t){for(var r=0;r<t.length;r++){var a=t[r];if(a[0]==q.REG)await c(a[1],a[2],a[3],a[4]);else if(a[0]==q.REGMASK)await w(a[1],a[2],a[3],a[4]);else if(a[0]==q.DEMODREG)await m(a[1],a[2],a[3],a[4]);else if(a[0]==q.I2CREG)await T(a[1],a[2],a[3]);else throw"Unsupported operation ["+a+"]"}}function l(t){for(var r=[],a=new Uint8Array(t),p=0;p<a.length;++p)r.push("0x"+a[p].toString(16));return"["+r+"]"}return{writeRegister:c,readRegister:i,writeRegMask:w,demod:{readRegister:b,writeRegister:m},i2c:{open:S,close:I,readRegister:O,writeRegister:T,readRegBuffer:k},bulk:{readBuffer:C},iface:{claim:E,release:x},writeEach:f}}var q={REG:1,REGMASK:2,DEMODREG:3,I2CREG:4},F={DEMOD:0,USB:256,SYS:512,I2C:1536},le={SYSCTL:8192,EPA_CTL:8520,EPA_MAXPKT:8536,DEMOD_CTL:12288,DEMOD_CTL_1:12299};B.CMD=q;B.BLOCK=F;B.REG=le;var ue=B.CMD;function K(e,o){var u=[131,50,117,192,64,214,108,245,99,117,104,108,131,128,0,15,0,192,48,72,204,96,0,84,174,74,192],d=[[0,8,2,223],[50,8,2,190],[55,8,2,139],[60,8,2,123],[65,8,2,105],[70,8,2,88],[75,0,2,68],[90,0,2,52],[110,0,2,36],[140,0,2,20],[180,0,2,19],[250,0,2,17],[280,0,2,0],[310,0,65,0],[588,0,64,0]],s=[0,8,4,12,2,10,6,14,1,9,5,13,3,11,7,15],c=!1,i;async function w(){await v(u),await S()}async function b(x){return await k(x),await U(x)}async function m(){await E([[6,177,255],[5,179,255],[7,58,255],[8,64,255],[9,192,255],[10,54,255],[12,53,255],[15,104,255],[17,3,255],[23,244,255],[25,12,255]])}async function S(){await E([[12,0,15],[19,49,63],[29,0,56]]);var x=await T(!0);await E([[10,16|x,31],[11,107,239],[7,0,128],[6,16,48],[30,64,96],[5,0,128],[31,0,128],[15,0,128],[25,96,96],[29,229,199],[28,36,248],[13,83,255],[14,117,255],[5,0,96],[6,0,8],[17,56,8],[23,48,48],[10,64,96],[29,0,56],[28,0,4],[6,0,64],[26,48,48],[29,24,56],[28,36,4],[30,13,31],[26,32,48]])}async function I(){await E([[5,0,16],[7,16,16],[12,11,159]])}async function O(x){var f=0;x<=15?f=Math.round(1.36+x*(1.1118+x*(-.0786+x*.0027))):f=Math.round(1.2068+x*(.6875+x*(-.01011+x*1587e-7))),f<0?f=0:f>30&&(f=30);var l=Math.floor(f/2),t=Math.floor((f-1)/2);await E([[5,16,16],[7,0,16],[12,8,159],[5,l,15],[7,t,15]])}async function T(x){if(await E([[11,107,96],[15,4,4],[16,0,3]]),await U(56e6),!c)throw new Error("PLL not locked -- cannot tune to the selected frequency.");await E([[11,16,16],[11,0,16],[15,0,4]]);var f=await g(0,5),l=new Uint8Array(f),t=l[4]&15;return t==15&&(t=0),t!=0&&x?await T(!1):t}async function k(x){for(var f=x/1e6,l=0;l<d.length-1&&!(f<d[l+1][0]);++l);var t=d[l];await E([[23,t[1],8],[26,t[2],195],[27,t[3],255],[16,0,11],[8,0,63],[9,0,63]])}async function U(x){var f=Math.floor(o);await E([[16,0,16],[26,0,12],[18,128,224]]);var l=Math.min(6,Math.floor(Math.log(177e7/x)/Math.LN2)),t=1<<l+1,r=await g(0,5),a=new Uint8Array(r),p=(a[4]&48)>>4;p>2?--l:p<2&&++l,await C(16,l<<5,224);var y=x*t,_=Math.floor(y/(2*f)),j=y%(2*f);if(_>63){c=!1;return}var X=Math.floor((_-13)/4),Q=(_-13)%4;await E([[20,X+(Q<<6),255],[18,j==0?8:0,8]]);var z=Math.min(65535,Math.floor(32768*j/f));await E([[22,z>>8,255],[21,z&255,255]]),await h(!0),await C(26,8,8);var W=2*f*(_+z/65536)/t;return W}async function h(x){var f=await g(0,3),l=new Uint8Array(f);if(l[2]&64){c=!0;return}if(x)return await C(18,96,224),await h(!1);c=!1}async function v(x){i=new Uint8Array(x);for(var f=[],l=0;l<x.length;++l)f.push([ue.I2CREG,52,l+5,x[l]]);await e.writeEach(f)}async function g(x,f){for(var l=await e.i2c.readRegBuffer(52,x,f),t=new Uint8Array(l),r=0;r<t.length;++r){var a=t[r];t[r]=s[a&15]<<4|s[a>>4]}return t.buffer}async function C(x,f,l){var t=i[x-5],r=t&~l|f&l;i[x-5]=r,await e.i2c.writeRegister(52,x,r)}async function E(x){for(var f=0;f<x.length;f++){var l=x[f];await C(l[0],l[1],l[2])}}return{init:w,setFrequency:b,setAutoGain:I,setManualGain:O,close:m}}K.check=async function(e){var o=await e.i2c.readRegister(52,0);return o==105};var n=B.CMD,A=B.BLOCK,L=B.REG;function de(e,o,u){var d=288e5,s=357e4,c=2,i=new B(e),w;async function b(){await i.writeEach([[n.REG,A.USB,L.SYSCTL,9,1],[n.REG,A.USB,L.EPA_MAXPKT,512,2],[n.REG,A.USB,L.EPA_CTL,528,2]]),await i.iface.claim(),await i.writeEach([[n.REG,A.SYS,L.DEMOD_CTL_1,34,1],[n.REG,A.SYS,L.DEMOD_CTL,232,1],[n.DEMODREG,1,1,20,1],[n.DEMODREG,1,1,16,1],[n.DEMODREG,1,21,0,1],[n.DEMODREG,1,22,0,2],[n.DEMODREG,1,22,0,1],[n.DEMODREG,1,23,0,1],[n.DEMODREG,1,24,0,1],[n.DEMODREG,1,25,0,1],[n.DEMODREG,1,26,0,1],[n.DEMODREG,1,27,0,1],[n.DEMODREG,1,28,202,1],[n.DEMODREG,1,29,220,1],[n.DEMODREG,1,30,215,1],[n.DEMODREG,1,31,216,1],[n.DEMODREG,1,32,224,1],[n.DEMODREG,1,33,242,1],[n.DEMODREG,1,34,14,1],[n.DEMODREG,1,35,53,1],[n.DEMODREG,1,36,6,1],[n.DEMODREG,1,37,80,1],[n.DEMODREG,1,38,156,1],[n.DEMODREG,1,39,13,1],[n.DEMODREG,1,40,113,1],[n.DEMODREG,1,41,17,1],[n.DEMODREG,1,42,20,1],[n.DEMODREG,1,43,113,1],[n.DEMODREG,1,44,116,1],[n.DEMODREG,1,45,25,1],[n.DEMODREG,1,46,65,1],[n.DEMODREG,1,47,165,1],[n.DEMODREG,0,25,5,1],[n.DEMODREG,1,147,240,1],[n.DEMODREG,1,148,15,1],[n.DEMODREG,1,17,0,1],[n.DEMODREG,1,4,0,1],[n.DEMODREG,0,97,96,1],[n.DEMODREG,0,6,128,1],[n.DEMODREG,1,177,27,1],[n.DEMODREG,0,13,131,1]]);var h=Math.floor(d*(1+o/1e6));await i.i2c.open();var v=await K.check(i);if(v&&(w=new K(i,h)),!w)throw new Error("Sorry, your USB dongle has an unsupported tuner chip. Only the R820T chip is supported.");var g=-1*Math.floor(s*(1<<22)/h);await i.writeEach([[n.DEMODREG,1,177,26,1],[n.DEMODREG,0,8,77,1],[n.DEMODREG,1,25,g>>16&63,1],[n.DEMODREG,1,26,g>>8&255,1],[n.DEMODREG,1,27,g&255,1],[n.DEMODREG,1,21,1,1]]),await w.init(),await m(u),await i.i2c.close()}async function m(h){h==null?await w.setAutoGain():await w.setManualGain(h)}async function S(h){var v=Math.floor(d*4194304/h);v&=268435452;var g=Math.floor(d*(1<<22)/v),C=-1*Math.floor(o*(1<<24)/1e6);return await i.writeEach([[n.DEMODREG,1,159,v>>16&65535,2],[n.DEMODREG,1,161,v&65535,2],[n.DEMODREG,1,62,C>>8&63,1],[n.DEMODREG,1,63,C&255,1]]),await I(),g}async function I(){await i.writeEach([[n.DEMODREG,1,1,20,1],[n.DEMODREG,1,1,16,1]])}async function O(h){await i.i2c.open();var v=await w.setFrequency(h+s);return await i.i2c.close(),v-s}async function T(){await i.writeEach([[n.REG,A.USB,L.EPA_CTL,528,2],[n.REG,A.USB,L.EPA_CTL,0,2]])}async function k(h){return await i.bulk.readBuffer(h*c)}async function U(){await i.i2c.open(),await w.close(),await i.i2c.close(),await i.iface.release()}return{open:b,setSampleRate:S,setCenterFrequency:O,resetBuffer:T,readSamples:k,close:U}}const H=[{vendorId:3034,productId:10290},{vendorId:3034,productId:10296}];function M(e){this._usbDevice=e,this._rtl2832u=null}M.prototype.open=async function(e){await this._usbDevice.open(),await this._usbDevice.selectConfiguration(1),this._rtl2832u=new de(this._usbDevice,e.ppm||0,e.gain||null),await this._rtl2832u.open()};M.prototype.setSampleRate=async function(e){return await this._rtl2832u.setSampleRate(e)};M.prototype.setCenterFrequency=async function(e){return await this._rtl2832u.setCenterFrequency(e)};M.prototype.resetBuffer=async function(){await this._rtl2832u.resetBuffer()};M.prototype.readSamples=async function(e){return await this._rtl2832u.readSamples(e)};M.prototype.close=async function(){await this._rtl2832u.close(),await this._usbDevice.close()};M.requestDevice=async function(){let e=await D.requestDevice(H);return new M(e)};M.getDevices=async function(){let e=await D.getDevices(H);const o=[];return e.forEach(u=>{o.push(new M(u))}),o};class pe{constructor(o){P(this,"enableRead",!1);P(this,"device",null);P(this,"demodulator",null);this.store=o}async init(){this.device=await M.requestDevice(),await this.device.open({ppm:0}),await this.device.setSampleRate(2e6),await this.device.setCenterFrequency(109e7),await this.device.resetBuffer(),this.demodulator=new ee}async start(o){this.enableRead=!0;try{for(;this.enableRead;){const u=await this.device.readSamples(262144),d=new Uint8Array(u);this.demodulator.process(d,d.length,(s=>{this.store.addMessage(s),o!=null&&o()}).bind(this))}}catch(u){alert(u)}}stop(){this.enableRead=!1}}const we=({receiver:e,aircrafts:o})=>{const[u,d]=R.exports.useState(!1),[s,c]=R.exports.useState(!1),i=te(s),w=()=>{c(!0),setTimeout(()=>{c(!1)},500)},b=async()=>{await e.current.init(),e.current.start(w),d(!0)};return $(ae,{children:[$(re,{align:"center",sx:{position:"fixed",top:0,left:0,width:"100vw",height:10,px:2},spacing:4,children:[G(V,{justify:"center",children:G(ne,{fontSize:"1rem",variant:i?"solid":"outline",colorScheme:i?"green":"gray",px:2,children:"RCEV"})}),G(ie,{color:"gray",fontFamily:"Menlo",whiteSpace:"pre-wrap",children:(()=>{const S=String(o.length).padStart(3," ");return`SHOW:${String(o.filter(O=>O.lat!==0).length).padStart(3," ")} / DECD:${S}`})()})]}),!u&&G(V,{align:"center",justify:"center",sx:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backdropFilter:"blur(5px) brightness(300%)"},onClick:b})]})};const he={version:8,metadata:{},sources:{ne2_shaded:{maxzoom:6,tileSize:256,tiles:["https://tiles.openfreemap.org/natural_earth/ne2sr/{z}/{x}/{y}.png"],type:"raster"},openmaptiles:{type:"vector",url:"https://tiles.openfreemap.org/planet"}},sprite:"https://tiles.openfreemap.org/sprites/ofm_f384/ofm",glyphs:"https://tiles.openfreemap.org/fonts/{fontstack}/{range}.pbf",layers:[{id:"background",type:"background",paint:{"background-color":"rgba(0, 0, 0, 1)"}},{id:"water",type:"fill",source:"openmaptiles","source-layer":"water",filter:["all",["match",["geometry-type"],["MultiPolygon","Polygon"],!0,!1],["!=",["get","brunnel"],"tunnel"]],paint:{"fill-antialias":!0,"fill-color":"rgba(16, 16, 16, 1)"}},{id:"aeroway-taxiway",type:"line",source:"openmaptiles","source-layer":"aeroway",minzoom:0,filter:["match",["get","class"],["taxiway"],!0,!1],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"rgba(82, 82, 82, 1)","line-opacity":1,"line-width":["interpolate",["exponential",1.55],["zoom"],13,1.8,20,20]}},{id:"aeroway-area",type:"fill",source:"openmaptiles","source-layer":"aeroway",minzoom:0,filter:["all",["match",["geometry-type"],["MultiPolygon","Polygon"],!0,!1],["match",["get","class"],["runway","taxiway"],!0,!1]],layout:{visibility:"visible"},paint:{"fill-color":"rgba(255, 255, 255, 1)","fill-opacity":["interpolate",["linear"],["zoom"],13,0,14,1]}},{id:"aeroway-runway",type:"line",source:"openmaptiles","source-layer":"aeroway",minzoom:0,filter:["all",["match",["get","class"],["runway"],!0,!1],["match",["geometry-type"],["LineString","MultiLineString"],!0,!1]],layout:{"line-cap":"square","line-join":"miter",visibility:"visible","line-miter-limit":0},paint:{"line-color":"rgba(63, 63, 63, 1)","line-opacity":1,"line-width":["interpolate",["exponential",1.5],["zoom"],11,4,17,50]}}],id:"3vnr5hczv"},ye=({aircrafts:e,zoom:o,setZoom:u})=>{const d=R.exports.useRef(null),s=R.exports.useRef(null),c=R.exports.useRef([]);return R.exports.useEffect(()=>{s.current||(s.current=new N.Map({container:d.current,style:he,center:[139.5,35.8],zoom:o}),s.current.on("zoomend",()=>{s.current&&u(s.current.getZoom())}))},[o,u]),R.exports.useEffect(()=>{!s.current||(c.current.forEach(i=>i.remove()),c.current=[],e.forEach(i=>{const w=document.createElement("div");w.style.color="white",w.style.fontFamily="Menlo",w.style.lineHeight="1";const b=i.callsign.length>0?i.callsign:"---",m=i.altitude===0?"---":String(Math.floor(i.altitude/100)).padStart(3,"0"),S=i.speed===0?"---":String(Math.floor(i.speed)).padStart(3,"0"),I=270<i.heading&&i.heading<360||0<i.heading&&i.heading<90;w.innerHTML=`
        <div style="margin-top: 4px; width: 14px; height: 14px; border: 1px solid white; position: relative;">
          <div style="
            position: absolute;
            top: 6px;
            left: 6px;
            height: 1px;
            width: ${i.speed/7}px;
            background-color: white;
            z-index: -1;
            transform: rotate(${Math.floor(i.heading)-90}deg);
            transform-origin: left top;
          "></div>
          <div style="
            position: absolute;
            top: 6px;
            left: 6px;
            height: 1px;
            width: 7px;
            background-color: black;
            z-index: -1;
            transform: rotate(${Math.floor(i.heading)-90}deg);
            transform-origin: left top;
          "></div>
          ${o>8.5?`
            <div style="
              position: absolute;
              bottom: ${I?"-40px":"14px"};
              left: -1px;
              font-size: 12px;
            ">
              <div>${b}</div>
              <div>${m}</div>
              <div>${S}</div>
            </div>
          `:""}
        </div>
      `;const O=new N.Marker(w).setLngLat([i.lng,i.lat]).addTo(s.current);c.current.push(O)}))},[e,o]),G(Y,{ref:d,style:{width:"100vw",height:"100vh"}})};function ve(){const e=R.exports.useRef(new oe({timeout:15e3})),o=R.exports.useRef(new pe(e.current)),[u,d]=R.exports.useState(9),[s,c]=R.exports.useState([]);return R.exports.useEffect(()=>{const i=setInterval(()=>{c(e.current.getAircrafts())},1e3);return()=>{clearInterval(i)}},[]),$(Y,{width:"100vw",height:"100vh",sx:{overflow:"hidden"},children:[G(ye,{aircrafts:s,zoom:u,setZoom:d}),G(we,{receiver:o,aircrafts:s})]})}se.render(G(xe.StrictMode,{children:G(ce,{children:G(ve,{})})}),document.getElementById("root"));
